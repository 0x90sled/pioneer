#
# Winding is always CCW. DEVIATION SHOULD BE CONSIDERED A BUG!!11
#
# 3d primitive arguments:


model(simple_cargo, scale=1.0, radius=1.0) {
	lod { full, 20px, 10px }
	objlod cyl_lod = { 24, 16, 8 }
	top = v(0,1,0)
	bottom = v(0,-1,0)
	textpos = vhermite(v(-1,-1,0), v(1,1,0), v(0,2,0), v(0,-2,0), animfn=gear)
	material(.5,.5,.5, 0,0,0, 0, 0,0,0)
	cylinder(cyl_lod, top, bottom, v(1,0,0), radius=1.0)
	lod1:material(1,0,0, 0,0,0, 0, 0,0,0)
	lod1:zbias(textpos, v(0,1,0))
	lod1:text(params:0, textpos, v(0,1,0), v(1,0,0), scale=0.1)
}

model(turd, scale=1.0, radius=50.0) {
	lod { full, 40px, 20px, 5px }
	objlod slod_a = { 8, 4, 2, 1 }
	objlod slod_tube = { 16, 10, 8, 4 }

	# right bot/top of +z extrusion end
	box_bot = v(15,-5,50)
	box_top = v(15,5,50)
	box_bot_flange = v(16,-5,51)
	box_top_flange = v(16,5,51)
	wingtip = v(40,-3,40)
	front_wingtip = v(15,-5,-30)
	material(.3,.3,.3, .6,.6,.6, 100, 0,0,0)
	# rear
	quad(box_top, v(-15,5,50), v(-15,-5,50), box_bot)
	# arse flange
	xref:quad(
		box_bot,
		box_bot_flange,
		box_top_flange,
		box_top
	)
	# arse curved bits
	xref:smooth(slod_a, 
		line(wingtip),
		hermite(box_top_flange, v(-50,0,20), v(50,-30,-20)), # herm 1
		line(box_bot_flange))
	# top of wing
	xref:smooth(slod_a, 
		hermite(wingtip, v(50,-30,-20), v(-50,0,20)), # herm 1
		hermite(front_wingtip, v(0,0,-80), v(40,0,40)), # herm 2 leading edge
#			line(v(15, 5, -30)),
		line(box_top),
		line(box_top_flange))
	# bottom of wing
	xref:flat(slod_a, v(0,-1,0),
		line(box_bot),
		line(front_wingtip),
		hermite(wingtip, v(40,0,40), v(0,0,-80)), # herm3 leading edge lower
		line(box_bot_flange))
	# inner wing bit
	xref:tri(front_wingtip, box_bot, box_top)

	# top and bottom at rear
	quad(box_top, v(15,4.3,45), v(-15,4.3,45), v(-15,5,50))
	quad(box_bot, v(-15,-5,50), v(-15,-5,35), v(15,-5,35))
	quad(v(15,-5,35), v(-15,-5,35), v(-15,1,30), v(15,1,30))

	tri(v(-15,4.3,45), v(15,4.3,45), v(0, 3.5, 35))
#		xref:quad(v(0,4,35), v(15,5,45), v(15,4,35), v(0,3.5,25))

	# make materials be assignable
	material(.3,0,0, .7,0,0, 100, 0,0,0)
	xref:tri(v(0,3.5,35),v(15,4.3,45), v(15,3,35))
	material(.3,.3,.3, .6,.6,.6, 100, 0,0,0)
	# top body bit
	xref:smooth(slod_a, 
		line(v(15,3,35)),
		hermite(v(0,-1,0), v(0,0,-50), v(10,5,30)),
		hermite(v(0,3.5,35),v(0,20,30), v(0,0,-30)))

	smooth(slod_a,
		hermite(v(0,-1,0), v(0,0,-50), v(-10,5,30)),
		hermite(v(15,3,35), v(10,5,30), v(0,0,-50)),
		hermite(v(-15,3,35), v(0,-30,0), v(0,-30,0)))

	# front engines
	xref:smooth(slod_a, 
		hermite(v(15,-5,-10), v(-10,0,0), v(-10,0,0)),
		line(v(15,-5,50)),
		hermite(v(15,5,50), v(-10,0,0), v(-10,0,0)),
		line(v(15,-2.5,-10)))

	# engines
	material(.1,.1,.1, .7,.7,.7, 150.0, 0,0,0)
	
	# front
	# rear
	tube(slod_tube, v(0,0,50), v(0,0,52), v(0,1,0), innerrad=3.5, outerrad=4)
	xref:tube(slod_tube, v(10,0,50), v(10,0,52), v(0,1,0), innerrad=3.5, outerrad=4)
	material(animfn=thrustpulse,
		material(0,0,0, 0,0,0, 0, .2,.2,1),
		material(0,0,0, 0,0,0, 0, .7,.7,1))
	# front
	xref:flat(slod_a, v(0,0,-1),
		line(v(15,-5,-10)),
		hermite(v(15,-2.5,-10), v(-10,0,0), v(-10,0,0)))
	#rear
	zbias(v(0,0,50), v(0,0,1))
	circle(slod_tube, v(0,0,50), v(0,0,1), v(0,1,0), radius=3.5)
	xref:circle(slod_tube, v(10,0,50), v(0,0,1), v(0,1,0), radius=3.5)
#	xref:circle(slod_tube, v(10,0,3), v(0,0,-1), v(0,1,0), radius=2.5)
	nozbias()

	xref:notangular:thruster(fwd, v(10,0,50), 50.0)
	notangular:thruster(fwd, v(0,0,50), 50.0)
	xref:notangular:thruster(rev, v(14,-3.75,-10), 25.0)
	# license plate
	material(.9,.9,.9, 0,0,0, 0, 0,0,0)
	idtext_pos = v(0, 4.65, 47.5)
	zbias(idtext_pos, v(0,0,1))
	lod1:text(params:0, idtext_pos,
		vnormal(
		v(-15,4.3,45),
		v(-15,5,50),
		box_top
		),
		v(1,0,0), scale=3)
}

model(hermite_wank, scale=1, radius=1) {
	# 1/8th sphere
	v6 = v(0.0, 5.0, 0.0)
	v7 = v(-5.0, 0.0, 0.0 )
	v8 = v(0.0, 0.0, 5.0 )

	v9 = v(-7.0, 0.0, 0.0 )			
	v10 = v(0.0, 7.0, 0.0 )
	v11 = v(0.0, 0.0, 7.0 )			
	material(.2,.0,.2, 1,0,1, 10, 0,0,0)
	xref:smooth(8, 
		hermite(v7, v9, v10),
		hermite(v8, v11, v9),
		hermite(v6, v10, v11))

	material(1, 0, 1, 0, 0, 0, 1, 0, 0, 0)
	extrusion(v(0,0,0), v(0,0,10), n(0,-1,0), radius=1.0,
		{
			v(-3.0, 0.0, 0),
			v(-2.0, -2.0, 0),
			v(2.0, -2.0, 0),			
			v(6.0, 0.0, 0),			
			v(2.0, 2.0, 0),
			v(-2.0, 2.0, 0)
		})
	xref:notangular:thruster(fwd, v(10,0,0), 30.0)
	xref:thruster(rev, v(10,0,0), 10.0)
	xref:thruster(up, v(10,0,0), 20.0)
	xref:thruster(down, v(10,0,0), 20.0)
	thruster(left, v(0,0,0), 20.0)
	thruster(right, v(0,0,0), 20.0)
}

model(junk, scale=1.5, radius=1.0) {
	lod { full, 5px, 2.5px }
	objlod arse = { 16, 10, 8 }
	
	material(.5,.5,.5,0,0,0, 0, 0,0,0)
	geomflag(10)
	xref:tube(arse, v(15,-20,0), vlinear(v(15,-15,0), v(15,-10,0), animfn=gear), v(0,0,1), innerrad=5.0, outerrad=10.0)
	quad(v(1,-2,0), v(1,-1,0), v(0,-1,0), v(0,-2,0))
	circle(arse, v(15,0,0), v(0,0,1), v(0,1,0), radius=10.0)
	xref:cylinder(arse, v(15,10,0), v(15,20,0), v(0,0,1), radius=10.0)

	subobject(hermite_wank, v(0,0,0), v(0,1,0), v(0,0,1), scale=1.0)
	subobject(hermite_wank, v(0,0,0), v(0,-1,0), v(0,0,1), scale=1.0, animfn=gear)
}

model(cargo, scale=1.0, radius=1.0) {
	lod { full, 20px, 10px }
	objlod cyl_lod = { 16, 16, 8 }

	top = v(0,1,0)
	bottom = v(0,-1,0)
	textpos = v(0,0.8,0)

	material(.5,.5,.5, 0,0,0, 0, 0,0,0)
	lod2:lod3:cylinder(cyl_lod, top, bottom, v(1,0,0), radius=1.0)
	
	lod1:tube(16, top, bottom, v(1,0,0), innerrad=0.9, outerrad=1.0)
	lod1:cylinder(16, textpos, v(0,-0.8,0), v(1,0,0), radius=0.9)
	lod1:material(1,0,0, 0,0,0, 0, 0,0,0)
	lod1:zbias(textpos, v(0,1,0))
	lod1:text(params:0, textpos, v(0,1,0), v(1,0,0), scale=0.1)
}

